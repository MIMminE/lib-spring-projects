<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>WebSocket í´ë¼ì´ì–¸íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #log { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; background: #f9f9f9; }
        button { margin: 5px; padding: 10px; }
        #messageInput, #roomInput { width: 300px; padding: 10px; }
    </style>
</head>
<body>
    <h2>WebSocket í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸</h2>
    <div>
        <input type="text" id="roomInput" placeholder="ë°© ë²ˆí˜¸ ì…ë ¥">
        <button onclick="connect()">ì—°ê²°</button>
        <button onclick="disconnect()">í•´ì œ</button>
        <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ ì…ë ¥">
        <button onclick="sendMessage()">ì „ì†¡</button>
    </div>
    <div id="log"></div>

    <script>
        let socket = null;

        function connect() {
            const roomInput = document.getElementById('roomInput');
            const roomNumber = roomInput.value.trim();

            if (!roomNumber) {
                log('ë°© ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            if (socket) {
                log('ì´ë¯¸ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                const socket = new WebSocket(`ws://localhost:8080/chat?roomId=${roomNumber}`);

<!--                socket.onopen = () => {-->
<!--                    log('ğŸŸ¢ WebSocket ì—°ê²° ì„±ê³µ');-->
<!--                    // ì—°ê²° í›„ ë°© ë²ˆí˜¸ ì „ì†¡-->
<!--                    const joinMessage = {-->
<!--                        type: 'JOIN',-->
<!--                        room_number: roomNumber-->
<!--                    };-->
<!--                    socket.send(JSON.stringify(joinMessage));-->
<!--                };-->

                socket.onmessage = (event) => {
                    log('ğŸ“¥ ìˆ˜ì‹ : ' + event.data);
                };

                socket.onclose = () => {
                    log('ğŸ”´ WebSocket ì—°ê²° í•´ì œ');
                    socket = null;
                };

                socket.onerror = (error) => {
                    log('âŒ WebSocket ì—ëŸ¬ ë°œìƒ');
                    console.error('WebSocket error:', error);
                };
            } catch (exception) {
                log('âŒ WebSocket ì—°ê²° ì‹œë„ ì¤‘ ì˜ˆì™¸ ë°œìƒ');
                console.error('Exception during WebSocket connection:', exception);
            }
        }

        function disconnect() {
            if (socket) {
                socket.close();
            } else {
                log('ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            if (socket && input.value) {
                const message = {
                    type: 'CHAT',
                    content: input.value
                };
                socket.send(JSON.stringify(message));
                log('ğŸ“¤ ì „ì†¡: ' + input.value);
                input.value = '';
            }
        }

        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString('ko-KR');
            logDiv.innerHTML += `<div>[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
    </script>
</body>
</html>